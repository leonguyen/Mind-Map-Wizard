<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
        <title>Mind Map Wizard</title>

        <link rel="icon" type="image/png" href="/img/favicon96.png" sizes="96x96">
        <link rel="icon" type="image/png" href="/img/favicon64.png" sizes="64x48">
        <link rel="icon" type="image/png" href="/img/favicon48.png" sizes="48x48">
        <link rel="icon" type="image/png" href="/img/favicon32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="/img/favicon16.png" sizes="16x16">
        <link rel="icon" type="image/x-icon" href="/img/favicon.ico">
        <link rel="apple-touch-icon" href="/img/logo.png">

        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-title" content="Mind Map Wizard">

        <link rel="stylesheet" href="/styles/edit.css">

        <link rel="prefetch" href="/history.html">
        <style>
            #markdown-editor {
              width: 100%;
              height: 300px;
              font-family: monospace;
              white-space: pre-wrap;
              line-height: 1.6;
              border: 1px solid #ccc;
              padding: 8px;
              overflow: auto;
              background-color: white;
              outline: none;
            }
            #markdown-editor div {
              padding-left: calc(max(0em, 2em * (var(--indent-level, 0) - 1)));
              font-size: calc(1.6rem - min(0.9rem, 0.3rem * var(--heading-level, 0)));
              font-weight: calc(700 - min(200, 100 * (var(--heading-level, 0) - 1))); 
              min-height: 1.6em;
            }
            
            #markdown-editor div[style*="--heading-level: 1"],
            #markdown-editor div[style*="--heading-level: 2"],
            #markdown-editor div[style*="--heading-level: 3"] {
              font-weight: 700;
            }
            
            #markdown-editor div[style*="--indent-level: 2"] {
              margin-top: 0.8em;
            }

            #markdown-editor div[style*="--indent-level: 1"] {
              padding-left: 0em;
            }

            #markdown-editor div[style*="--indent-level: 2"] {
              padding-left: 0.5em;
            }
            #markdown-editor div[style*="--indent-level: 3"] {
              margin-top: 0.5em;
            }

            .hash-prefix {
              color: #bcbcbc;
              opacity: 0.7;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <div class="header-left">
                <a onclick="openLink('/')" style="text-decoration: none;">
                    <h1>
                        <img src="/img/logo.svg" height="35" width="35" class="logo">
                            <span class="logo-text">Mind Map Wizard</span>
                        </h1>
                    </a>
                </div>
                <div class="nav-links">
                    <a onclick="openLink('/history.html')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>
                            History</a>
                    </div>
                    <a class="navbutton" onclick="openLink('/')" id="create-with-ai-button">
                        Create with AI</a>
                </div>
                <div class="container">
                
                    <div class="input-section">
                        <div class="toolbar">
                            <button onclick="createNewMindMap()" class="new-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg></button>
                            <button onclick="saveToHistory()" class="save-button">Save</button>
                        </div>
                <textarea id="markdown-input" placeholder="Enter your markdown here...">
# Mind Map

## Branch
## Branch
                </textarea>
            </div>
            <a class="help-button" onclick="openLink('https://mindmapwizard.com/help/mind-map-editing.html')" style="text-decoration: none;">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>            </a>

            <div class="mindmap-section">
                <div class="markmap" id="markmap-container"></div>
            </div>
            
            <div id="floating-ad-container">
                <button id="ad-close-btn" aria-label="Close Ad"></button>

                <div id="ad-content-area">
                </div>
            </div>
            </div>

            <div class="notification" id="saveNotification">
                <span class="success-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                </span>
                Successfully saved to history!
            </div>

            <div class="notification" id="newMapNotification">
                <span class="success-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                </span>
                New Mind Map Created
            </div>

        <div class="share-dialog" id="saveDialog" style="display: none;">
            <h3>Save Current Mind Map</h3>
            <p>Enter a name for your mind map:</p>
            <input type="text" id="mindmapName" class="share-link" placeholder="My Mind Map">
            <div class="dialog-buttons">
                <button class="dialog-button cancel" onclick="closeSaveDialog()">Cancel</button>
                <button class="dialog-button confirm" onclick="saveWithName()">Save</button>
            </div>
        </div>

        <div class="share-dialog" id="newConfirmDialog" style="display: none;">
            <h3>Create New Mind Map</h3>
            <p>Do you really want to create a new mind map?<br>You can still access your old mind map in the mind map history.</p>
            <div class="dialog-buttons">
                <button class="dialog-button cancel" onclick="closeNewConfirmDialog()">Cancel</button>
                <button class="dialog-button confirm" onclick="createNewMindMap();">Create New</button>
            </div>
        </div>
        
        <script src="https://cdn.jsdelivr.net/npm/markmap-autoloader@latest"></script>
        
        <script>
                let currentMindMapId = null;

                const textarea = document.getElementById('markdown-input');
                const container = document.getElementById('markmap-container');

                window.addEventListener('load', initializeMindMap);
                textarea.addEventListener('input', handleInputChange);

                function initializeMindMap() {
                    const urlParams = new URLSearchParams(window.location.search);
                    const idParam = urlParams.get('id');

                    if (idParam === 'new') {
                        createNewMindMap();
                    } else if (idParam === 'guide') {
                        currentMindMapId = 'guide';
                        loadGuideContent();
                    } else if (idParam) {
                        loadMindMapFromId(idParam);
                    } else {
                        loadFromLocalStorage();
                    }

                    renderMindmap();
                }

                function renderMindmap() {
                        if (!window.markmap || !window.markmap.Markmap) {
                            setTimeout(renderMindmap, 300); return;
                        }
                        try {
                            container.innerHTML = '';
                            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                            container.appendChild(svg);
                            const { Markmap, Transformer } = window.markmap;
                            const transformer = new Transformer();
                            const { root } = transformer.transform(textarea.value);
                            Markmap.create(svg, { autoFit: true, duration: 0 }, root);
                        } catch (error) { console.error("Error rendering mind map:", error); }
                    }

                    function loadGuideContent() {
                        textarea.value = `# Playground 

## Links
                            
### [New Mind Map](https://mindmapwizard.com/new) 
### [Pricing (Only $1!)](https://mindmapwizard.com/pricing) 
                            
## Features
                            
Note that if blocks and lists appear at the same level, the lists will be ignored. 
                            
### Lists 
                            
#### **strong** #### ~~del~~ 
####  *italic* #### \`inline code\`
                            
### Ordered list 
1. item 1
2. item 2 
                            
### Blocks
                            
\`\`\`js
console.log('hello, JavaScript')
\`\`\`
                            
![](https://mindmapwizard.com/img/favicon64.png)`;
                        renderMindmap();
                    }

                function loadFromLocalStorage() {
                    const savedMindmap = localStorage.getItem('mindmap-playground');
                    if (savedMindmap) {
                        console.log('Found old mind map in "mindmap-playground". Migrating to "mindmap-history".');
                        const mindmapData = JSON.parse(savedMindmap);
                        
                        currentMindMapId = mindmapData.id || Date.now().toString();
                        textarea.value = mindmapData.markdown;
                        
                        const topic = mindmapData.topic || mindmapData.markdown.split('\n')[0].replace('# ', '').trim();
                        saveToLocalStorage(topic, mindmapData.markdown);
                        localStorage.removeItem('mindmap-playground');
                        
                        const newUrl = new URL(window.location);
                        newUrl.searchParams.set('id', currentMindMapId);
                        window.history.replaceState({}, '', newUrl);

                    } else {
                        createNewMindMap();
                    }
                }


                function createNewMindMap() {
                    const defaultTitle = "Mind Map";
                    const defaultMarkdown = "# Mind Map\n\n## Branch\n## Branch";

                    textarea.value = defaultMarkdown;
                    renderMindmap();

                    createMindMapLocally(defaultTitle, defaultMarkdown);

                    const notification = document.getElementById('newMapNotification');
                    if (notification) {
                        notification.classList.add('show');
                        setTimeout(() => notification.classList.remove('show'), 2000);
                    }
                }

                function loadMindMapFromId(id) {
                    const foundMindMap = JSON.parse(localStorage.getItem('mindmap-history') || '[]').find(item => item.id.toString() === id);

                    if (foundMindMap) {
                        textarea.value = foundMindMap.markdown;
                        currentMindMapId = foundMindMap.id;
                    } else {
                        createNewMindMap();
                    }
                }

                function createMindMapLocally(title, markdown) {
                    currentMindMapId = Date.now().toString();
                    saveToLocalStorage(title, markdown);

                    const newUrl = new URL(window.location);
                    newUrl.searchParams.set('id', currentMindMapId);
                    window.history.replaceState({}, '', newUrl);
                }
            

                    function handleInputChange() {
                        renderMindmap();

                        const markdown = textarea.value;
                        const topic = markdown.split('\n')[0].replace('# ', '').trim() || 'Untitled';

                        saveToLocalStorage(topic, markdown);
                    }



                function saveToHistory() {
                    const saveDialog = document.getElementById('saveDialog');
                    const overlay = document.querySelector('.overlay');

                    const firstLine = textarea.value.split('\n')[0];
                    const defaultName = firstLine.replace(/^#+ /, '').trim();
                    document.getElementById('mindmapName').value = defaultName;

                    saveDialog.style.display = 'block';
                    overlay.style.display = 'block';
                    document.getElementById('mindmapName').focus();
                }

                    function saveToLocalStorage(topic, markdown) {
                        const mindmapData = {
                            id: currentMindMapId,
                            markdown,
                            timestamp: new Date().toISOString(),
                            topic
                        };

                        const history = JSON.parse(localStorage.getItem('mindmap-history') || '[]');
                        const index = history.findIndex(item => item.id.toString() === currentMindMapId.toString());

                        if (index !== -1) {
                            history[index] = mindmapData;
                        } else {
                            history.unshift(mindmapData);
                            if (history.length > 500) history.pop();
                        }

                        localStorage.setItem('mindmap-history', JSON.stringify(history));
                    }

                function saveWithName() {
                    const mindmapName = document.getElementById('mindmapName').value.trim();
                    if (!mindmapName) {
                        alert("Please enter a name for your mind map");
                        return;
                    }

                    const mindmapData = {
                        id: currentMindMapId,
                        markdown: textarea.value,
                        timestamp: new Date().toISOString(),
                        topic: mindmapName
                    };

                    const existingHistory = JSON.parse(localStorage.getItem('mindmap-history') || '[]');

                    const existingIndex = existingHistory.findIndex(item => item.id === currentMindMapId);

                    if (existingIndex !== -1) {
                        existingHistory[existingIndex] = mindmapData;
                    } else {
                        existingHistory.unshift(mindmapData);
                        if (existingHistory.length > 100) {
                            existingHistory.pop();
                        }
                    }

                    localStorage.setItem('mindmap-history', JSON.stringify(existingHistory));

                    closeSaveDialog();

                    const saveDialog = document.getElementById('saveDialog');
                    if (saveDialog.dataset.afterSave === 'clear') {
                        currentMindMapId = Date.now();
                        resetPlayground();
                        saveDialog.dataset.afterSave = '';
                    } else {
                        const notification = document.getElementById('saveNotification');
                        notification.classList.add('show');

                        setTimeout(() => {
                            notification.classList.remove('show');
                        }, 2000);
                    }
                }

                function closeSaveDialog() {
                    const saveDialog = document.getElementById('saveDialog');
                    const overlay = document.querySelector('.overlay');

                    saveDialog.style.display = 'none';
                    overlay.style.display = 'none';

                    saveDialog.dataset.afterSave = '';
                }


                function shareMindmap() {
                    alert('Sharing functionality is not available in the local version.');
                }

                function openLink(url) {
                    window.location.href = url;
                }
</script>
              
<!--100 % privacy - first analytics-->
<script async src="https://scripts.simpleanalyticscdn.com/latest.js"></script> 
</body>
</html>